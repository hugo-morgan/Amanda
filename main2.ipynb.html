<html>
<head>
<title>main2.ipynb</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #bcbec4;}
.s1 { color: #cf8e6d;}
.s2 { color: #bcbec4;}
.s3 { color: #6aab73;}
.s4 { color: #2aacb8;}
.s5 { color: #7a7e85;}
.ls0 { height: 1px; border-width: 0; color: #43454a; background-color:#43454a}
</style>
</head>
<body bgcolor="#191a1c">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
main2.ipynb</font>
</center></td></tr></table>
<pre><span class="s0">#%% 
</span><span class="s1">import </span><span class="s0">os</span>
<span class="s1">import </span><span class="s0">pandas </span><span class="s1">as </span><span class="s0">pd</span>
<span class="s1">import </span><span class="s0">numpy </span><span class="s1">as </span><span class="s0">np</span>
<span class="s1">import </span><span class="s0">matplotlib</span><span class="s2">.</span><span class="s0">pyplot </span><span class="s1">as </span><span class="s0">plt</span>

<span class="s0">DATA_PATH </span><span class="s2">= </span><span class="s3">&quot;train.csv&quot;</span>
<span class="s0">OUTPUT_DIR </span><span class="s2">= </span><span class="s3">&quot;outputs&quot;</span>
<span class="s0">os</span><span class="s2">.</span><span class="s0">makedirs</span><span class="s2">(</span><span class="s0">OUTPUT_DIR</span><span class="s2">, </span><span class="s0">exist_ok</span><span class="s2">=</span><span class="s1">True</span><span class="s2">)</span>

<span class="s0">STORE_ID </span><span class="s2">= </span><span class="s4">1</span>
<span class="s0">ITEM_ID </span><span class="s2">= </span><span class="s4">1</span>

<span class="s0">HORIZON_DAYS </span><span class="s2">= </span><span class="s4">365</span>

<span class="s0">params </span><span class="s2">= {</span>

    <span class="s3">&quot;S_order&quot;</span><span class="s2">: </span><span class="s4">100.0</span><span class="s2">,</span>
    <span class="s3">&quot;H_hold&quot;</span><span class="s2">: </span><span class="s4">2.0</span><span class="s2">,</span>
    <span class="s3">&quot;p_stockout&quot;</span><span class="s2">: </span><span class="s4">10.0</span><span class="s2">,</span>
    <span class="s3">&quot;L&quot;</span><span class="s2">: </span><span class="s4">7</span><span class="s2">,</span>
    <span class="s3">&quot;z_values&quot;</span><span class="s2">: [</span><span class="s4">1.28</span><span class="s2">, </span><span class="s4">1.65</span><span class="s2">, </span><span class="s4">2.05</span><span class="s2">],</span>
<span class="s2">}</span>

<span class="s0">print</span><span class="s2">(</span><span class="s3">&quot;</span><span class="s1">\n</span><span class="s3">=== Parâmetros do Modelo (Hipóteses) ===&quot;</span><span class="s2">)</span>
<span class="s1">for </span><span class="s0">k</span><span class="s2">, </span><span class="s0">v </span><span class="s1">in </span><span class="s0">params</span><span class="s2">.</span><span class="s0">items</span><span class="s2">():</span>
    <span class="s0">print</span><span class="s2">(</span><span class="s3">f&quot;</span><span class="s1">{</span><span class="s0">k</span><span class="s1">}</span><span class="s3">: </span><span class="s1">{</span><span class="s0">v</span><span class="s1">}</span><span class="s3">&quot;</span><span class="s2">)</span><hr class="ls0"><span class="s0">#%% 
df </span><span class="s2">= </span><span class="s0">pd</span><span class="s2">.</span><span class="s0">read_csv</span><span class="s2">(</span><span class="s0">DATA_PATH</span><span class="s2">)</span>
<span class="s0">df</span><span class="s2">[</span><span class="s3">&quot;date&quot;</span><span class="s2">] = </span><span class="s0">pd</span><span class="s2">.</span><span class="s0">to_datetime</span><span class="s2">(</span><span class="s0">df</span><span class="s2">[</span><span class="s3">&quot;date&quot;</span><span class="s2">])</span>

<span class="s0">sub </span><span class="s2">= </span><span class="s0">df</span><span class="s2">[(</span><span class="s0">df</span><span class="s2">[</span><span class="s3">&quot;store&quot;</span><span class="s2">] == </span><span class="s0">STORE_ID</span><span class="s2">) &amp; (</span><span class="s0">df</span><span class="s2">[</span><span class="s3">&quot;item&quot;</span><span class="s2">] == </span><span class="s0">ITEM_ID</span><span class="s2">)].</span><span class="s0">sort_values</span><span class="s2">(</span><span class="s3">&quot;date&quot;</span><span class="s2">)</span>
<span class="s1">if </span><span class="s0">sub</span><span class="s2">.</span><span class="s0">empty</span><span class="s2">:</span>
    <span class="s1">raise </span><span class="s0">ValueError</span><span class="s2">(</span><span class="s3">&quot;Não há dados para essa combinação (store, item). Ajuste STORE_ID e ITEM_ID.&quot;</span><span class="s2">)</span>

<span class="s0">series </span><span class="s2">= </span><span class="s0">sub</span><span class="s2">.</span><span class="s0">set_index</span><span class="s2">(</span><span class="s3">&quot;date&quot;</span><span class="s2">)[</span><span class="s3">&quot;sales&quot;</span><span class="s2">]</span>

<span class="s0">demand </span><span class="s2">= </span><span class="s0">series</span><span class="s2">.</span><span class="s0">iloc</span><span class="s2">[-</span><span class="s0">HORIZON_DAYS</span><span class="s2">:] </span><span class="s1">if </span><span class="s0">len</span><span class="s2">(</span><span class="s0">series</span><span class="s2">) &gt; </span><span class="s0">HORIZON_DAYS </span><span class="s1">else </span><span class="s0">series</span><span class="s2">.</span><span class="s0">copy</span><span class="s2">()</span>

<span class="s0">mu_d </span><span class="s2">= </span><span class="s0">float</span><span class="s2">(</span><span class="s0">demand</span><span class="s2">.</span><span class="s0">mean</span><span class="s2">())</span>
<span class="s0">sigma_d </span><span class="s2">= </span><span class="s0">float</span><span class="s2">(</span><span class="s0">demand</span><span class="s2">.</span><span class="s0">std</span><span class="s2">(</span><span class="s0">ddof</span><span class="s2">=</span><span class="s4">1</span><span class="s2">))</span>

<span class="s0">print</span><span class="s2">(</span><span class="s3">&quot;</span><span class="s1">\n</span><span class="s3">=== Estatísticas da Demanda (recorte) ===&quot;</span><span class="s2">)</span>
<span class="s0">print</span><span class="s2">(</span><span class="s3">f&quot;Período: </span><span class="s1">{</span><span class="s0">demand</span><span class="s2">.</span><span class="s0">index</span><span class="s2">.</span><span class="s0">min</span><span class="s2">().</span><span class="s0">date</span><span class="s2">()</span><span class="s1">} </span><span class="s3">até </span><span class="s1">{</span><span class="s0">demand</span><span class="s2">.</span><span class="s0">index</span><span class="s2">.</span><span class="s0">max</span><span class="s2">().</span><span class="s0">date</span><span class="s2">()</span><span class="s1">}  </span><span class="s3">|  N=</span><span class="s1">{</span><span class="s0">len</span><span class="s2">(</span><span class="s0">demand</span><span class="s2">)</span><span class="s1">} </span><span class="s3">dias&quot;</span><span class="s2">)</span>
<span class="s0">print</span><span class="s2">(</span><span class="s3">f&quot;Média diária (μd): </span><span class="s1">{</span><span class="s0">mu_d</span><span class="s1">:</span><span class="s3">.4f</span><span class="s1">}</span><span class="s3">&quot;</span><span class="s2">)</span>
<span class="s0">print</span><span class="s2">(</span><span class="s3">f&quot;Desvio padrão diário (σd): </span><span class="s1">{</span><span class="s0">sigma_d</span><span class="s1">:</span><span class="s3">.4f</span><span class="s1">}</span><span class="s3">&quot;</span><span class="s2">)</span><hr class="ls0"><span class="s0">#%% 
D_annual </span><span class="s2">= </span><span class="s0">mu_d </span><span class="s2">* </span><span class="s4">365.0</span>
<span class="s0">S_order </span><span class="s2">= </span><span class="s0">params</span><span class="s2">[</span><span class="s3">&quot;S_order&quot;</span><span class="s2">]</span>
<span class="s0">H_hold </span><span class="s2">= </span><span class="s0">params</span><span class="s2">[</span><span class="s3">&quot;H_hold&quot;</span><span class="s2">]</span>

<span class="s0">EOQ </span><span class="s2">= </span><span class="s0">int</span><span class="s2">(</span><span class="s0">max</span><span class="s2">(</span><span class="s4">1</span><span class="s2">, </span><span class="s0">round</span><span class="s2">(</span><span class="s0">np</span><span class="s2">.</span><span class="s0">sqrt</span><span class="s2">((</span><span class="s4">2.0 </span><span class="s2">* </span><span class="s0">D_annual </span><span class="s2">* </span><span class="s0">S_order</span><span class="s2">) / </span><span class="s0">H_hold</span><span class="s2">)))) </span><span class="s1">if </span><span class="s0">H_hold </span><span class="s2">&gt; </span><span class="s4">0 </span><span class="s1">else </span><span class="s0">int</span><span class="s2">(</span><span class="s0">max</span><span class="s2">(</span><span class="s4">1</span><span class="s2">, </span><span class="s0">round</span><span class="s2">(</span><span class="s0">D_annual</span><span class="s2">)))</span>
<span class="s0">print</span><span class="s2">(</span><span class="s3">&quot;</span><span class="s1">\n</span><span class="s3">=== EOQ (benchmark) ===&quot;</span><span class="s2">)</span>
<span class="s0">print</span><span class="s2">(</span><span class="s3">f&quot;Demanda anual estimada (D): </span><span class="s1">{</span><span class="s0">D_annual</span><span class="s1">:</span><span class="s3">.2f</span><span class="s1">}</span><span class="s3">&quot;</span><span class="s2">)</span>
<span class="s0">print</span><span class="s2">(</span><span class="s3">f&quot;EOQ (Q): </span><span class="s1">{</span><span class="s0">EOQ</span><span class="s1">}</span><span class="s3">&quot;</span><span class="s2">)</span><hr class="ls0"><span class="s0">#%% 
</span><span class="s1">def </span><span class="s0">compute_reorder_point</span><span class="s2">(</span><span class="s0">mu_d</span><span class="s2">: </span><span class="s0">float</span><span class="s2">, </span><span class="s0">sigma_d</span><span class="s2">: </span><span class="s0">float</span><span class="s2">, </span><span class="s0">L</span><span class="s2">: </span><span class="s0">int</span><span class="s2">, </span><span class="s0">z</span><span class="s2">: </span><span class="s0">float</span><span class="s2">):</span>

    <span class="s0">mu_LT </span><span class="s2">= </span><span class="s0">mu_d </span><span class="s2">* </span><span class="s0">L</span>
    <span class="s0">sigma_LT </span><span class="s2">= </span><span class="s0">sigma_d </span><span class="s2">* </span><span class="s0">np</span><span class="s2">.</span><span class="s0">sqrt</span><span class="s2">(</span><span class="s0">L</span><span class="s2">)</span>
    <span class="s0">SS </span><span class="s2">= </span><span class="s0">z </span><span class="s2">* </span><span class="s0">sigma_LT</span>
    <span class="s0">R </span><span class="s2">= </span><span class="s0">mu_LT </span><span class="s2">+ </span><span class="s0">SS</span>
    <span class="s1">return </span><span class="s0">mu_LT</span><span class="s2">, </span><span class="s0">sigma_LT</span><span class="s2">, </span><span class="s0">SS</span><span class="s2">, </span><span class="s0">R</span>

<span class="s1">def </span><span class="s0">simulate_qr</span><span class="s2">(</span><span class="s0">demand_series</span><span class="s2">: </span><span class="s0">pd</span><span class="s2">.</span><span class="s0">Series</span><span class="s2">, </span><span class="s0">Q</span><span class="s2">: </span><span class="s0">int</span><span class="s2">, </span><span class="s0">R</span><span class="s2">: </span><span class="s0">float</span><span class="s2">, </span><span class="s0">L</span><span class="s2">: </span><span class="s0">int</span><span class="s2">,</span>
                <span class="s0">S_order</span><span class="s2">: </span><span class="s0">float</span><span class="s2">, </span><span class="s0">H_hold</span><span class="s2">: </span><span class="s0">float</span><span class="s2">, </span><span class="s0">p_stockout</span><span class="s2">: </span><span class="s0">float</span><span class="s2">):</span>

    <span class="s0">holding_daily </span><span class="s2">= </span><span class="s0">H_hold </span><span class="s2">/ </span><span class="s4">365.0</span>

    <span class="s0">on_hand </span><span class="s2">= </span><span class="s0">float</span><span class="s2">(</span><span class="s0">R</span><span class="s2">)</span>
    <span class="s0">pipeline </span><span class="s2">= []</span>

    <span class="s0">total_demand </span><span class="s2">= </span><span class="s4">0.0</span>
    <span class="s0">filled </span><span class="s2">= </span><span class="s4">0.0</span>
    <span class="s0">stockout_units </span><span class="s2">= </span><span class="s4">0.0</span>
    <span class="s0">stockout_days </span><span class="s2">= </span><span class="s4">0</span>
    <span class="s0">orders </span><span class="s2">= </span><span class="s4">0</span>

    <span class="s0">cost_order </span><span class="s2">= </span><span class="s4">0.0</span>
    <span class="s0">cost_hold </span><span class="s2">= </span><span class="s4">0.0</span>

    <span class="s0">stock_hist </span><span class="s2">= []</span>

    <span class="s1">for </span><span class="s0">d </span><span class="s1">in </span><span class="s0">demand_series</span><span class="s2">.</span><span class="s0">values</span><span class="s2">:</span>
        <span class="s0">new_pipeline </span><span class="s2">= []</span>
        <span class="s0">arriving_today </span><span class="s2">= </span><span class="s4">0.0</span>
        <span class="s1">for </span><span class="s0">days_left</span><span class="s2">, </span><span class="s0">qty </span><span class="s1">in </span><span class="s0">pipeline</span><span class="s2">:</span>
            <span class="s1">if </span><span class="s0">days_left </span><span class="s2">- </span><span class="s4">1 </span><span class="s2">&lt;= </span><span class="s4">0</span><span class="s2">:</span>
                <span class="s0">arriving_today </span><span class="s2">+= </span><span class="s0">qty</span>
            <span class="s1">else</span><span class="s2">:</span>
                <span class="s0">new_pipeline</span><span class="s2">.</span><span class="s0">append</span><span class="s2">((</span><span class="s0">days_left </span><span class="s2">- </span><span class="s4">1</span><span class="s2">, </span><span class="s0">qty</span><span class="s2">))</span>
        <span class="s0">pipeline </span><span class="s2">= </span><span class="s0">new_pipeline</span>
        <span class="s0">on_hand </span><span class="s2">+= </span><span class="s0">arriving_today</span>
        <span class="s0">cost_hold </span><span class="s2">+= </span><span class="s0">holding_daily </span><span class="s2">* </span><span class="s0">on_hand</span>
        <span class="s0">total_demand </span><span class="s2">+= </span><span class="s0">float</span><span class="s2">(</span><span class="s0">d</span><span class="s2">)</span>
        <span class="s1">if </span><span class="s0">on_hand </span><span class="s2">&gt;= </span><span class="s0">d</span><span class="s2">:</span>
            <span class="s0">on_hand </span><span class="s2">-= </span><span class="s0">float</span><span class="s2">(</span><span class="s0">d</span><span class="s2">)</span>
            <span class="s0">filled </span><span class="s2">+= </span><span class="s0">float</span><span class="s2">(</span><span class="s0">d</span><span class="s2">)</span>
        <span class="s1">else</span><span class="s2">:</span>
            <span class="s0">filled </span><span class="s2">+= </span><span class="s0">on_hand</span>
            <span class="s0">stockout_units </span><span class="s2">+= </span><span class="s0">float</span><span class="s2">(</span><span class="s0">d</span><span class="s2">) - </span><span class="s0">on_hand</span>
            <span class="s0">on_hand </span><span class="s2">= </span><span class="s4">0.0</span>
            <span class="s0">stockout_days </span><span class="s2">+= </span><span class="s4">1</span>

        <span class="s0">inv_position </span><span class="s2">= </span><span class="s0">on_hand </span><span class="s2">+ </span><span class="s0">sum</span><span class="s2">(</span><span class="s0">qty </span><span class="s1">for </span><span class="s0">_</span><span class="s2">, </span><span class="s0">qty </span><span class="s1">in </span><span class="s0">pipeline</span><span class="s2">)</span>
        <span class="s1">if </span><span class="s0">inv_position </span><span class="s2">&lt;= </span><span class="s0">R</span><span class="s2">:</span>
            <span class="s0">pipeline</span><span class="s2">.</span><span class="s0">append</span><span class="s2">((</span><span class="s0">L</span><span class="s2">, </span><span class="s0">float</span><span class="s2">(</span><span class="s0">Q</span><span class="s2">)))</span>
            <span class="s0">orders </span><span class="s2">+= </span><span class="s4">1</span>
            <span class="s0">cost_order </span><span class="s2">+= </span><span class="s0">S_order</span>

        <span class="s0">stock_hist</span><span class="s2">.</span><span class="s0">append</span><span class="s2">(</span><span class="s0">on_hand</span><span class="s2">)</span>

    <span class="s0">cost_stockout </span><span class="s2">= </span><span class="s0">p_stockout </span><span class="s2">* </span><span class="s0">stockout_units</span>
    <span class="s0">total_cost </span><span class="s2">= </span><span class="s0">cost_order </span><span class="s2">+ </span><span class="s0">cost_hold </span><span class="s2">+ </span><span class="s0">cost_stockout</span>

    <span class="s0">fill_rate </span><span class="s2">= </span><span class="s0">filled </span><span class="s2">/ </span><span class="s0">total_demand </span><span class="s1">if </span><span class="s0">total_demand </span><span class="s2">&gt; </span><span class="s4">0 </span><span class="s1">else </span><span class="s4">0.0</span>
    <span class="s0">csl </span><span class="s2">= </span><span class="s4">1 </span><span class="s2">- (</span><span class="s0">stockout_days </span><span class="s2">/ </span><span class="s0">len</span><span class="s2">(</span><span class="s0">demand_series</span><span class="s2">)) </span><span class="s1">if </span><span class="s0">len</span><span class="s2">(</span><span class="s0">demand_series</span><span class="s2">) &gt; </span><span class="s4">0 </span><span class="s1">else </span><span class="s4">0.0</span>

    <span class="s1">return </span><span class="s2">{</span>
        <span class="s3">&quot;Q&quot;</span><span class="s2">: </span><span class="s0">Q</span><span class="s2">,</span>
        <span class="s3">&quot;R&quot;</span><span class="s2">: </span><span class="s0">float</span><span class="s2">(</span><span class="s0">R</span><span class="s2">),</span>
        <span class="s3">&quot;orders&quot;</span><span class="s2">: </span><span class="s0">orders</span><span class="s2">,</span>
        <span class="s3">&quot;fill_rate&quot;</span><span class="s2">: </span><span class="s0">float</span><span class="s2">(</span><span class="s0">fill_rate</span><span class="s2">),</span>
        <span class="s3">&quot;CSL&quot;</span><span class="s2">: </span><span class="s0">float</span><span class="s2">(</span><span class="s0">csl</span><span class="s2">),</span>
        <span class="s3">&quot;stockout_units&quot;</span><span class="s2">: </span><span class="s0">float</span><span class="s2">(</span><span class="s0">stockout_units</span><span class="s2">),</span>
        <span class="s3">&quot;cost_order&quot;</span><span class="s2">: </span><span class="s0">float</span><span class="s2">(</span><span class="s0">cost_order</span><span class="s2">),</span>
        <span class="s3">&quot;cost_hold&quot;</span><span class="s2">: </span><span class="s0">float</span><span class="s2">(</span><span class="s0">cost_hold</span><span class="s2">),</span>
        <span class="s3">&quot;cost_stockout&quot;</span><span class="s2">: </span><span class="s0">float</span><span class="s2">(</span><span class="s0">cost_stockout</span><span class="s2">),</span>
        <span class="s3">&quot;total_cost&quot;</span><span class="s2">: </span><span class="s0">float</span><span class="s2">(</span><span class="s0">total_cost</span><span class="s2">),</span>
        <span class="s3">&quot;stock_hist&quot;</span><span class="s2">: </span><span class="s0">np</span><span class="s2">.</span><span class="s0">array</span><span class="s2">(</span><span class="s0">stock_hist</span><span class="s2">),</span>
    <span class="s2">}</span>
<hr class="ls0"><span class="s0">#%% 
results </span><span class="s2">= []</span>
<span class="s0">L </span><span class="s2">= </span><span class="s0">params</span><span class="s2">[</span><span class="s3">&quot;L&quot;</span><span class="s2">]</span>

<span class="s1">for </span><span class="s0">z </span><span class="s1">in </span><span class="s0">params</span><span class="s2">[</span><span class="s3">&quot;z_values&quot;</span><span class="s2">]:</span>
    <span class="s0">mu_LT</span><span class="s2">, </span><span class="s0">sigma_LT</span><span class="s2">, </span><span class="s0">SS</span><span class="s2">, </span><span class="s0">R </span><span class="s2">= </span><span class="s0">compute_reorder_point</span><span class="s2">(</span><span class="s0">mu_d</span><span class="s2">, </span><span class="s0">sigma_d</span><span class="s2">, </span><span class="s0">L</span><span class="s2">, </span><span class="s0">z</span><span class="s2">)</span>
    <span class="s0">out </span><span class="s2">= </span><span class="s0">simulate_qr</span><span class="s2">(</span>
        <span class="s0">demand_series</span><span class="s2">=</span><span class="s0">demand</span><span class="s2">,</span>
        <span class="s0">Q</span><span class="s2">=</span><span class="s0">EOQ</span><span class="s2">,</span>
        <span class="s0">R</span><span class="s2">=</span><span class="s0">R</span><span class="s2">,</span>
        <span class="s0">L</span><span class="s2">=</span><span class="s0">L</span><span class="s2">,</span>
        <span class="s0">S_order</span><span class="s2">=</span><span class="s0">params</span><span class="s2">[</span><span class="s3">&quot;S_order&quot;</span><span class="s2">],</span>
        <span class="s0">H_hold</span><span class="s2">=</span><span class="s0">params</span><span class="s2">[</span><span class="s3">&quot;H_hold&quot;</span><span class="s2">],</span>
        <span class="s0">p_stockout</span><span class="s2">=</span><span class="s0">params</span><span class="s2">[</span><span class="s3">&quot;p_stockout&quot;</span><span class="s2">],</span>
    <span class="s2">)</span>
    <span class="s0">out</span><span class="s2">.</span><span class="s0">update</span><span class="s2">({</span>
        <span class="s3">&quot;policy&quot;</span><span class="s2">: </span><span class="s3">&quot;Q,R&quot;</span><span class="s2">,</span>
        <span class="s3">&quot;z&quot;</span><span class="s2">: </span><span class="s0">float</span><span class="s2">(</span><span class="s0">z</span><span class="s2">),</span>
        <span class="s3">&quot;SS&quot;</span><span class="s2">: </span><span class="s0">float</span><span class="s2">(</span><span class="s0">SS</span><span class="s2">),</span>
        <span class="s3">&quot;mu_LT&quot;</span><span class="s2">: </span><span class="s0">float</span><span class="s2">(</span><span class="s0">mu_LT</span><span class="s2">),</span>
        <span class="s3">&quot;sigma_LT&quot;</span><span class="s2">: </span><span class="s0">float</span><span class="s2">(</span><span class="s0">sigma_LT</span><span class="s2">),</span>
        <span class="s3">&quot;store&quot;</span><span class="s2">: </span><span class="s0">STORE_ID</span><span class="s2">,</span>
        <span class="s3">&quot;item&quot;</span><span class="s2">: </span><span class="s0">ITEM_ID</span><span class="s2">,</span>
        <span class="s3">&quot;horizon_days&quot;</span><span class="s2">: </span><span class="s0">len</span><span class="s2">(</span><span class="s0">demand</span><span class="s2">),</span>
    <span class="s2">})</span>
    <span class="s0">results</span><span class="s2">.</span><span class="s0">append</span><span class="s2">(</span><span class="s0">out</span><span class="s2">)</span>

<span class="s0">res_df </span><span class="s2">= </span><span class="s0">pd</span><span class="s2">.</span><span class="s0">DataFrame</span><span class="s2">(</span><span class="s0">results</span><span class="s2">)</span>
<span class="s0">res_df </span><span class="s2">= </span><span class="s0">res_df</span><span class="s2">.</span><span class="s0">sort_values</span><span class="s2">(</span><span class="s3">&quot;z&quot;</span><span class="s2">).</span><span class="s0">reset_index</span><span class="s2">(</span><span class="s0">drop</span><span class="s2">=</span><span class="s1">True</span><span class="s2">)</span>

<span class="s0">print</span><span class="s2">(</span><span class="s3">&quot;</span><span class="s1">\n</span><span class="s3">=== Resultados (resumo) ===&quot;</span><span class="s2">)</span>
<span class="s0">print</span><span class="s2">(</span><span class="s0">res_df</span><span class="s2">[[</span><span class="s3">&quot;z&quot;</span><span class="s2">, </span><span class="s3">&quot;Q&quot;</span><span class="s2">, </span><span class="s3">&quot;R&quot;</span><span class="s2">, </span><span class="s3">&quot;SS&quot;</span><span class="s2">, </span><span class="s3">&quot;fill_rate&quot;</span><span class="s2">, </span><span class="s3">&quot;CSL&quot;</span><span class="s2">, </span><span class="s3">&quot;stockout_units&quot;</span><span class="s2">, </span><span class="s3">&quot;total_cost&quot;</span><span class="s2">]])</span>

<span class="s5"># Salvar tabela</span>
<span class="s0">res_csv_path </span><span class="s2">= </span><span class="s0">os</span><span class="s2">.</span><span class="s0">path</span><span class="s2">.</span><span class="s0">join</span><span class="s2">(</span><span class="s0">OUTPUT_DIR</span><span class="s2">, </span><span class="s3">&quot;results_qr.csv&quot;</span><span class="s2">)</span>
<span class="s0">res_df</span><span class="s2">.</span><span class="s0">to_csv</span><span class="s2">(</span><span class="s0">res_csv_path</span><span class="s2">, </span><span class="s0">index</span><span class="s2">=</span><span class="s1">False</span><span class="s2">)</span>
<span class="s0">print</span><span class="s2">(</span><span class="s3">f&quot;</span><span class="s1">\n</span><span class="s3">Tabela salva em: </span><span class="s1">{</span><span class="s0">res_csv_path</span><span class="s1">}</span><span class="s3">&quot;</span><span class="s2">)</span><hr class="ls0"><span class="s0">#%% 
labels </span><span class="s2">= [</span><span class="s3">f&quot;Q,R z=</span><span class="s1">{</span><span class="s0">z</span><span class="s1">:</span><span class="s3">.2f</span><span class="s1">}</span><span class="s3">&quot; </span><span class="s1">for </span><span class="s0">z </span><span class="s1">in </span><span class="s0">res_df</span><span class="s2">[</span><span class="s3">&quot;z&quot;</span><span class="s2">]]</span>
<span class="s0">costs </span><span class="s2">= </span><span class="s0">res_df</span><span class="s2">[</span><span class="s3">&quot;total_cost&quot;</span><span class="s2">].</span><span class="s0">values</span>
<span class="s0">fill_rates </span><span class="s2">= </span><span class="s0">res_df</span><span class="s2">[</span><span class="s3">&quot;fill_rate&quot;</span><span class="s2">].</span><span class="s0">values</span>

<span class="s0">plt</span><span class="s2">.</span><span class="s0">figure</span><span class="s2">(</span><span class="s0">figsize</span><span class="s2">=(</span><span class="s4">8</span><span class="s2">,</span><span class="s4">4</span><span class="s2">))</span>
<span class="s0">plt</span><span class="s2">.</span><span class="s0">bar</span><span class="s2">(</span><span class="s0">labels</span><span class="s2">, </span><span class="s0">costs</span><span class="s2">)</span>
<span class="s0">plt</span><span class="s2">.</span><span class="s0">title</span><span class="s2">(</span><span class="s3">&quot;Figura 6 – Custo total por política (Q,R)&quot;</span><span class="s2">)</span>
<span class="s0">plt</span><span class="s2">.</span><span class="s0">xlabel</span><span class="s2">(</span><span class="s3">&quot;Política&quot;</span><span class="s2">)</span>
<span class="s0">plt</span><span class="s2">.</span><span class="s0">ylabel</span><span class="s2">(</span><span class="s3">&quot;Custo total&quot;</span><span class="s2">)</span>
<span class="s0">plt</span><span class="s2">.</span><span class="s0">xticks</span><span class="s2">(</span><span class="s0">rotation</span><span class="s2">=</span><span class="s4">45</span><span class="s2">, </span><span class="s0">ha</span><span class="s2">=</span><span class="s3">&quot;right&quot;</span><span class="s2">)</span>
<span class="s0">plt</span><span class="s2">.</span><span class="s0">tight_layout</span><span class="s2">()</span>
<span class="s0">fig1_path </span><span class="s2">= </span><span class="s0">os</span><span class="s2">.</span><span class="s0">path</span><span class="s2">.</span><span class="s0">join</span><span class="s2">(</span><span class="s0">OUTPUT_DIR</span><span class="s2">, </span><span class="s3">&quot;Figura_1_Custo_Total.png&quot;</span><span class="s2">)</span>
<span class="s0">plt</span><span class="s2">.</span><span class="s0">savefig</span><span class="s2">(</span><span class="s0">fig1_path</span><span class="s2">, </span><span class="s0">dpi</span><span class="s2">=</span><span class="s4">300</span><span class="s2">)</span>
<span class="s0">plt</span><span class="s2">.</span><span class="s0">show</span><span class="s2">()</span><hr class="ls0"><span class="s0">#%% 
plt</span><span class="s2">.</span><span class="s0">figure</span><span class="s2">(</span><span class="s0">figsize</span><span class="s2">=(</span><span class="s4">8</span><span class="s2">,</span><span class="s4">4</span><span class="s2">))</span>
<span class="s0">plt</span><span class="s2">.</span><span class="s0">plot</span><span class="s2">(</span><span class="s0">labels</span><span class="s2">, </span><span class="s0">fill_rates</span><span class="s2">, </span><span class="s0">marker</span><span class="s2">=</span><span class="s3">&quot;o&quot;</span><span class="s2">)</span>
<span class="s0">plt</span><span class="s2">.</span><span class="s0">title</span><span class="s2">(</span><span class="s3">&quot;Figura 7 – Fill Rate por política (Q,R)&quot;</span><span class="s2">)</span>
<span class="s0">plt</span><span class="s2">.</span><span class="s0">xlabel</span><span class="s2">(</span><span class="s3">&quot;Política&quot;</span><span class="s2">)</span>
<span class="s0">plt</span><span class="s2">.</span><span class="s0">ylabel</span><span class="s2">(</span><span class="s3">&quot;Fill Rate&quot;</span><span class="s2">)</span>
<span class="s0">plt</span><span class="s2">.</span><span class="s0">ylim</span><span class="s2">(</span><span class="s4">0</span><span class="s2">, </span><span class="s4">1.05</span><span class="s2">)</span>
<span class="s0">plt</span><span class="s2">.</span><span class="s0">xticks</span><span class="s2">(</span><span class="s0">rotation</span><span class="s2">=</span><span class="s4">45</span><span class="s2">, </span><span class="s0">ha</span><span class="s2">=</span><span class="s3">&quot;right&quot;</span><span class="s2">)</span>
<span class="s0">plt</span><span class="s2">.</span><span class="s0">tight_layout</span><span class="s2">()</span>
<span class="s0">fig2_path </span><span class="s2">= </span><span class="s0">os</span><span class="s2">.</span><span class="s0">path</span><span class="s2">.</span><span class="s0">join</span><span class="s2">(</span><span class="s0">OUTPUT_DIR</span><span class="s2">, </span><span class="s3">&quot;Figura_2_Fill_Rate.png&quot;</span><span class="s2">)</span>
<span class="s0">plt</span><span class="s2">.</span><span class="s0">savefig</span><span class="s2">(</span><span class="s0">fig2_path</span><span class="s2">, </span><span class="s0">dpi</span><span class="s2">=</span><span class="s4">300</span><span class="s2">)</span>
<span class="s0">plt</span><span class="s2">.</span><span class="s0">show</span><span class="s2">()</span><hr class="ls0"><span class="s0">#%% 
plt</span><span class="s2">.</span><span class="s0">figure</span><span class="s2">(</span><span class="s0">figsize</span><span class="s2">=(</span><span class="s4">7</span><span class="s2">,</span><span class="s4">4</span><span class="s2">))</span>
<span class="s0">plt</span><span class="s2">.</span><span class="s0">scatter</span><span class="s2">(</span><span class="s0">fill_rates</span><span class="s2">, </span><span class="s0">costs</span><span class="s2">)</span>
<span class="s1">for </span><span class="s0">i</span><span class="s2">, </span><span class="s0">label </span><span class="s1">in </span><span class="s0">enumerate</span><span class="s2">(</span><span class="s0">labels</span><span class="s2">):</span>
    <span class="s0">plt</span><span class="s2">.</span><span class="s0">annotate</span><span class="s2">(</span><span class="s0">label</span><span class="s2">, (</span><span class="s0">fill_rates</span><span class="s2">[</span><span class="s0">i</span><span class="s2">], </span><span class="s0">costs</span><span class="s2">[</span><span class="s0">i</span><span class="s2">]))</span>
<span class="s0">plt</span><span class="s2">.</span><span class="s0">title</span><span class="s2">(</span><span class="s3">&quot;Figura 8 – Trade-off entre custo total e nível de serviço&quot;</span><span class="s2">)</span>
<span class="s0">plt</span><span class="s2">.</span><span class="s0">xlabel</span><span class="s2">(</span><span class="s3">&quot;Fill Rate&quot;</span><span class="s2">)</span>
<span class="s0">plt</span><span class="s2">.</span><span class="s0">ylabel</span><span class="s2">(</span><span class="s3">&quot;Custo total&quot;</span><span class="s2">)</span>
<span class="s0">plt</span><span class="s2">.</span><span class="s0">tight_layout</span><span class="s2">()</span>
<span class="s0">fig3_path </span><span class="s2">= </span><span class="s0">os</span><span class="s2">.</span><span class="s0">path</span><span class="s2">.</span><span class="s0">join</span><span class="s2">(</span><span class="s0">OUTPUT_DIR</span><span class="s2">, </span><span class="s3">&quot;Figura_3_Tradeoff.png&quot;</span><span class="s2">)</span>
<span class="s0">plt</span><span class="s2">.</span><span class="s0">savefig</span><span class="s2">(</span><span class="s0">fig3_path</span><span class="s2">, </span><span class="s0">dpi</span><span class="s2">=</span><span class="s4">300</span><span class="s2">)</span>
<span class="s0">plt</span><span class="s2">.</span><span class="s0">show</span><span class="s2">()</span><hr class="ls0"><span class="s0">#%% 
</span>

<span class="s0">print</span><span class="s2">(</span><span class="s3">&quot;</span><span class="s1">\n</span><span class="s3">=== Figuras salvas ===&quot;</span><span class="s2">)</span>
<span class="s0">print</span><span class="s2">(</span><span class="s0">fig1_path</span><span class="s2">)</span>
<span class="s0">print</span><span class="s2">(</span><span class="s0">fig2_path</span><span class="s2">)</span>
<span class="s0">print</span><span class="s2">(</span><span class="s0">fig3_path</span><span class="s2">)</span>

<span class="s0">print</span><span class="s2">(</span><span class="s3">&quot;</span><span class="s1">\n </span><span class="s3">Execução finalizada com sucesso.&quot;</span><span class="s2">)</span></pre>
</body>
</html>